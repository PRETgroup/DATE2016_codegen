\section{Hybrid Automata}
\label{sec:HA}



\acf{HA} is ideal for describing 
Cyber-physical systems. It is very expressive and
some constraints need to be imposed s.t. it is possible to  
generate synthesisable  code~[X]. In this section, 
we define a restricted \ac{HA} and then propose a discrete abstraction
called \acf{SHA} which is based on the
synchronous approach~\cite{benveniste03}.
Finally, we propose a deterministic semantics for \ac{SHA}.



\subsection{Example of \acf{HA} }

\begin{figure}
\centering
\input{figures/cellHA}
\caption{\acf{HA} of a heart cell \label{fig:heartCellHA}}
\end{figure}


For the four stages of action potential  shown in Figure~\ref{fig:actionPotential}, the \ac{HA} is
shown in Figure~\ref{fig:heartCellHA}.
The first stage (\ac{RP}), the continuous behaviour is captured 
by location~$q_0$. (ADD MORE DESCRIPTION ABOUT THE CELL).
We now formalise
the \ac{HA} using Definition~\ref{def:wha} and illustrate using Figure~\ref{fig:heartCellHA}.

\subsection{Definition of \acf{HA}}

\begin{definition}
	$HA = \langle Loc, X, \Sigma, Init, Inv, Flow,$ $ Jump \rangle$ where
	%Locations
	$Loc=\{q_0,q_1,q_2,q_3\}$ is a set of locations.
	$X=\{v,v_x,v_y,v_z\}$ is a set of continuous variables.
	$\Sigma=\Sigma_I \cup \Sigma_O \cup \{\iSignal\}$ is a set of
	 input, output, and internal events.
	$Init=\{(q_0,v): v\leq V_T\}$ is the initial condition.
	$Inv=\{(q_3,v): v\geq V_R\}$ is the invariant.
	$Flow=\{(q_0,v_x): a_{x}^{0} v_x\}$ specifies the continuous flow rate.
	$Jump=\{(q_n, q_m): signal, cond, update\}$: describes the discrete
	transition from $q_n$ and $q_m$ is enabled when $signal$ is 
	present and the $cond$ evaluates to true and $update$
	some variable during this transition.
	
	
	\label{def:ha}
\end{definition}

\subsection{Definition of \acf{SHA}}

A \ac{SHA} is a discreatised  abstraction of the corresponding \ac{HA}. It inherits all the
components of a \ac{HA} except that $Flow$ predicates are replaced by a
composite witness function $Switness$.
$Switness(l,k, \delta, i)=v_{k,l,i}$, which returns the evaluation of
the witness function in location $l$ at time step $k$.
We now formalise
the \ac{SHA} using Definition~\ref{def:sha} and illustrate using Figure~\ref{fig:heartCellSHA}.



\begin{definition}
	Given a 
	$HA = \langle Loc, X, \Sigma, Init,$ $ Inv, Flow, Jump \rangle$ a \ac{SHA} corresponding to
	this \ac{HA} is \newline
	$SHA = \langle Loc,  \Sigma, Init, Inv, Switness, Jump, Step \rangle$ where:
	\begin{itemize}
		\item $Step = \delta \in \mathbb{R}^+$: This specifies the duration of the synchronous instant,  duration between 
		two samples.
		\item
		$Switness: Loc \times \mathbb{N} \times \mathbb{R} \times
		\mathbb{R}^m \rightarrow \mathbb{R}^m$:
		is the witness function that returns the valuation of all the
		continuous variables at any valid time step $k$ in a given location
		$l$. It also takes as input the time step $\delta$ and the initial
		value from which execution begins in the location.
	\end{itemize}
	\label{def:sha}
\end{definition}


\begin{figure}
	\centering
	\input{figures/cellSHA}
	\caption{\acf{SHA} of the heart cell \label{fig:heartCellSHA}}
\end{figure}

\subsection{Deterministic semantics of \ac{SHA}}
Deterministic semantics of a \ac{SHA} is provided as a \acf{DTTS} in
Definition~\ref{def:dtts}. We assume that all transitions of a \acf{DTTS}
trigger relative to the ticks of the logical clock of the synchronous
program.

\begin{definition}
	The semantics of a \newline
	$SHA = \langle Loc,  \Sigma, Init, Inv, Switness, Jump, Step \rangle$
	 is a 
	$DTTS = \langle Q, Q^0, \Sigma, \rightarrow \rangle$ where
	
	\begin{itemize}
		\item The state-space is $Q$, where any state is of the form
		$(l, v, i, k)$ where $l$ is a location, $i$ is the initial valuation
		of the variables when execution begins in the location and $v$ is
		the valuation at the $k$-th instant.
		\item $Q^0 \subseteq Q$ where every $q^0 \in Q^0$ is of the form
		$(l, v^0, i, k)$ such that $v$ satisfies $Init(l)$.
		\item Transitions are of two types:
		\begin{itemize}
			\item \emph{Inter-location transitions} that lead to mode switches:
			These are of the form
			$(l, v, i, k) \stackrel{\sigma} \rightarrow (l', v', i', 0)$ if
			$(l, v, i, k) \in Q$, $(l', v', i', 0) \in Q$,
			$e=(l \stackrel{\sigma} \rightarrow l') \in Edge$ and $(v, v')$
			satisfy $Jump(e)$.
			\item \emph{Intra-location transitions} made during the execution in
			a given mode / location: These are of the form
			$(l, v, i, k) \rightarrow (l, v', i, k+1)$ if
			$(l, v, i, k) \in Q$, $(l, v', i, k+1) \in Q$, $(v, v')$ satisfy
			$Inv(l)$, $Switness(l,k,\delta,i)=v$ and $Switness(l,k+1,\delta,i)=v'$.
		\end{itemize}
	\end{itemize}
	\label{def:dtts}
\end{definition}

